#+AUTHOR: Alex Lu
#+EMAIL: alexluigit@gmail.com
#+startup: content

* *Dirvish*

[[https://melpa.org/#/dirvish][file:https://melpa.org/packages/dirvish-badge.svg]]
[[https://github.com/alexluigit/dirvish/actions/workflows/melpazoid.yml][file:https://github.com/alexluigit/dirvish/actions/workflows/melpazoid.yml/badge.svg]]

#+begin_quote
Wish you a better dired.
#+end_quote

#+ATTR_ORG: :width 1024
[[./assets/dirvish.png]]

| Preview                    | Layout1                        | Layout2               |
|----------------------------+--------------------------------+-----------------------|
| [[./assets/async-preview.gif]] | [[./assets/multiple-instance.gif]] | [[./assets/maximize.gif]] |

** Introduction

*Dirvish* is a minimalistic file manager based on *Dired*.

This package empowers dired by giving it a modern UI in an unintrusive
way. Emacs users deserve a file manager better than those popular ones in
terminal such as [[https://github.com/ranger/ranger][ranger]], [[https://github.com/vifm/vifm][vifm]], [[https://github.com/gokcehan/lf][lf]] since Emacs is more than a terminal emulator.

The name *dirvish* is a tribute to [[https://github.com/justinmk/vim-dirvish][vim-dirvish]].

*** Dependencies

| Package           | Description                | Required |
|-------------------+----------------------------+----------|
| =exa=               | Generate directory preview | Optional |
| =all-the-icons.el=  | Icon support               | Optional |
| =pdftoppm=          | Generate pdf preface image | Optional |
| =imagemagick=       | Generate image cache       | Optional |
| =ffmpegthumbnailer= | Generate video thumbnailer | Optional |
| =epub-thumbnailer=  | Generate epub thumbnailer  | Optional |
| =zipinfo=           | Preview zip files          | Optional |
| =mediainfo=         | Display media metadata     | Optional |

*** Installation

Dirvish is available on [[https://melpa.org][Melpa]].

**** For =package.el= user

You can install it directly via =package-install= if you have melpa in your =package-archives=.

**** For =straight.el= user

#+begin_src emacs-lisp
  (straight-use-package 'dirvish)
#+end_src

**** Manual install

To install it manually, first clone this repository, then add =path/to/dirvish= to your =load-path=.

#+begin_src emacs-lisp
  git clone https://github.com/alexluigit/dirvish

  (add-to-list 'load-path "/path/to/dirvish")
  (require 'dirvish)
#+end_src

*** Quickstart
**** =dirvish= && =dirvish-dired=

After installation, just =M-x= =dirvish=.

Since Dirvish is derived from Dired, all Dired commands stay the same as in
=dired-mode=, try pressing "(" to toggle =dired-hide-details-mode=, or =q= to quit
this instance.

=dirvish= command takes up the whole frame, but sometimes we prefer managing files
inside of current window, just like how dired does it. To get a "dirvish-ish"
dired, use =dirvish-dired=.

If you find some any Dired command doesn't work as expected, please report an [[https://github.com/alexluigit/dirvish/issues][issue]].

**** Override Dired

When you feel like to replace *Dired* with *Dirvish* completely (highly
recommended!), all you need is enable =dirvish-override-dired-mode=.

Now all Dired entry commands incluing =dired[-other-window/tab/frame]=,
=dired-jump[-other-window]= do their jobs in a "dirvish" way.

**** In relation to Dired config

Dirvish respects all of your dired options *except* the following ones:

| Option                                   | Reason                                                  |
|------------------------------------------+---------------------------------------------------------|
| =dired-kill-when-opening-new-dired-buffer= | Dirvish kill all buffers this instance holds when exits |
| =dired-switches-in-mode-line=              | Customize =dirvish-mode-line-format= instead            |

** Features
*** File preview

=dirvish= command places a preview window at right side of frame to show the
content of selected file.

The preview in Dirvish can be generated either directly from elisp or by the
help of shell commands. See =dirvish-preview-dispatchers= for more details. TODO:
better doc on this, maybe a wiki article.

*** Independent sessions

You can open multiple dirvish sessions across different windows / tabs /
frames. Each one of them have private attributes such as parent buffer
list, depth, =ls= command switches and so on.

Although the independence of Dirvish sessions, there are commands that operate
on multiple sessions such as =dirvish-yank=, you can take it as an example to
create your own cross-instance commands when you need to.

*** Asynchronous I/O

To prevent emacs from getting freezes, dirvish uses external process to deal
with heavy I/O task, such as file copy/move, directory preview, or image cache
generation etc.

*** Bulit-in icon support

You don't need [[https://github.com/jtbm37/all-the-icons-dired][all-the-icons-dired]] anymore since dirvish have built-in icon
support. Rendering icons natively gives us better integration with line
highlighting and more room to optimize performance (lazy rendering).

[[./assets/line-comparison.png]]

*** Extensions

Several small extension packages to Dirvish are maintained in the subdirectory
extensions/. These extensions are installed together with Dirvish if you pull
the package from MELPA. They are inactive by default and can be enabled manually
if desired. Currently the following extensions come with the Dirvish MELPA
package:

- [[file:extensions/dirvish-yank.el][dirvish-yank.el]]: Multi-stage copy/pasting of files.
- [[file:extensions/dirvish-menu.el][dirvish-menu.el]]: Keybindings help menu powered by =transient.el=.
- [[file:extensions/dirvish-peek.el][dirvish-peek.el]]: File preview in minibuffer.
- [[file:extensions/dirvish-diff.el][dirvish-diff.el]]: Show version-controlled diff in dirvish preview window.

With these extensions it is possible to adapt Dirvish such that it matches your
preference or behaves similar to other familiar file explorers. See
[[file:Configuration.org][Configuration.org]] for concrete examples.

** Configuration

See [[file:Configuration.org][Configuration.org]] for custom options and example config.

** Similar projects
*** Ranger.el

Although these 2 packages have something in common, unlike *ranger.el*, which
tries to become an all-around emulation of ranger, *dirvish* is more bare-bone,
meaning it does *NOT* try to port all "goodness" from ranger. Instead, it only
aims to:

- Provides a better dired UI
- Integrates all sensible dired commands

** Issues

- Bugs are expected on Windows since dirvish has not been tested on it.
- *WIP*: compatibility issues with some third-party dired related packages.

Feel free to report issues.

** Acknowledgements

This package is inspired a lot by [[https://github.com/ralesi/ranger.el][ranger.el]], thanks @ralesi for creating and
maintaining it.

